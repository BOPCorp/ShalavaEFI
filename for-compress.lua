local a,b,c,d,e,f,g,h,i,j,k="%pass%",%passOnBoot%,{"/init.lua","/OS.lua"},{},{},computer.pullSignal;computer.pullSignal=function(l,m)local n={f(l)}if n[1]=="key_down"then e[n[4]]=1 elseif n[1]=="key_up"then e[n[4]]=F end;if e[29]and e[56]and e[46]then if m then m()end;return"interrupted"elseif e[29]and e[32]then return"interrupted"else return table.unpack(n)end end;local function o(p)local address=component.list(p)()return address and component.proxy(address)end;local function q(r,s,t)local u,v=load("return "..r,s,F,t)if not u then u,v=load(r,s,F,t)end;if u then return xpcall(u,debug.traceback)else return F,v end end;local function w(x,y)local z={}for A in x:gmatch"[^\r\n]+"do z[#z+1]=A:gsub("\t",y and"    "or"")end;return z end;local function B(l,C,D)local E,G,r,H=computer.uptime()+(l or math.huge)repeat G,H,H,r=computer.pullSignal(E-computer.uptime())if G=="interrupted"or G=="key_down"and(r==C or C==0)then if D then D()end;return 1 end until computer.uptime()>=E end;local I,J,K=o"gp"or{},o"pr",component.list"sc"()computer.setBootAddress=J.setData;computer.getBootAddress=J.getData;J.get=J.getData;if I and K then I.bind(K)j,k=I.maxResolution()i=k/2;I.setPaletteColor(9,0x002b36)I.setPaletteColor(11,0x8cb9c5)end;local function L(M,N,O,P,Q)I.setBackground(P or 0x002b36)I.setForeground(Q or 0x8cb9c5)I.set(M,N,O)end;local function R(M,N,S,T,U,P,Q)I.setBackground(P or 0x002b36)I.setForeground(Q or 0x8cb9c5)I.fill(M,N,S,T,U)end;local function V()R(1,1,j,k," ")end;local function W(X)return math.ceil(j/2-X/2)end;local function Y(N,x,P,Q)L(W(unicode.len(x)),N,x,P,Q)end;local function Z(x,_,a0,C,D,a1,a2)if I and K then local z,N,a3=w(x),computer.uptime()+(a0 or 0),I.set;N=math.ceil(i-#z/2)I.setPaletteColor(9,0x002b36)I.setPaletteColor(11,0x8cb9c5)V()if _ then Y(N-1,_,0x002b36,0xFFFFFF)N=N+1 end;for a4=1,#z do Y(N,z[a4])N=N+1 end;if a1 and I and K then I.set=function(...)I.setPaletteColor(9,0x969696)I.setPaletteColor(11,0xb4b4b4)a3(...)I.set=a3 end end;if a2 then computer.beep(1000,.4)computer.beep(1000,.4)end;return B(a0 or 0,C,D)end end;local function a5(v)return I and K and Z(v,[[¯\_(ツ)_/¯]],math.huge,0,computer.shutdown,1)or error(v)end;local function a6(address)local o=component.proxy(address)if o and o.spaceTotal then d[#d+1]={o,o.getLabel()or"N/A",address}for a4=1,#c do if o.exists(c[a4])then d[#d][4]=c[a4]end end end end;local function a7()d={}a6(J.getData())for a8 in pairs(component.list"sy")do a6(J.getData()~=a8 and computer.tmpAddress()~=a8 and a8 or"")end end;local function a9(x,aa)return unicode.len(x)>aa and unicode.sub(x,1,aa).."…"or x end;local function ab(ac,ad,N,ae,af,ag)local ab,ah,ai,aj,M,ak,G,al,r,H="",unicode.len(ac),1,1;while 1 do G,H,al,r=computer.pullSignal(.5)if G=="interrupted"then ab=F;break elseif G=="key_down"then if al>=32 and unicode.len(ah..ab)<j-ah-1 then ab=unicode.sub(ab,1,ai-1)..unicode.char(al)..unicode.sub(ab,ai,-1)ai=ai+1 elseif al==8 and#ab>0 then ab=unicode.sub(unicode.sub(ab,1,ai-1),1,-2)..unicode.sub(ab,ai,-1)ai=ai-1 elseif al==13 then break elseif r==203 and ai>1 then ai=ai-1 elseif r==205 and ai<=unicode.len(ab)then ai=ai+1 elseif r==200 and ag then ab=ag;ai=unicode.len(ag)+1 elseif r==208 and ag then ab=""ai=1 end;aj=1 elseif G=="clipboard"then ab=unicode.sub(ab,1,ai-1)..al..unicode.sub(ab,ai,-1)ai=ai+unicode.len(al)elseif G~="key_up"then aj=not aj end;M=ae and W(unicode.len(ab)+ah)or ad;ak=M+ah+ai-1;R(1,N,j,1," ")L(M,N,ac..(af and("*"):rep(unicode.len(ab))or ab),0x002b36,0xFFFFFF)if ak<=j then L(ak,N,I.get(ak,N),aj and 0xFFFFFF or 0x002b36,aj and 0x002b36 or 0xFFFFFF)end end;R(1,N,j,1," ")return ab end;local function am(...)local x,z=table.pack(...)for a4=1,x.n do x[a4]=tostring(x[a4])end;z=w(table.concat(x,"    "),1)for a4=1,#z do I.copy(1,1,j,k-1,0,-1)R(1,k-1,j,1," ")L(1,k-1,z[a4])end end;local function an()if#a>0 and not g then local ao=ab("Password: ",F,i,1,1)if not ao then computer.shutdown()elseif ao~=a then a5"Access denied"end;g=1 end end;local function ap(aq,a1)address=a9(aq[3],a1 and 36 or 6)return aq[4]and("Boot%s %s from %s (%s)"):format(a1 and"ing"or"",aq[4],aq[2],address)or("Boot from %s (%s) is not available"):format(aq[2],address)end;local function ar(aq)if aq[4]then local as,at,u,au,v=aq[1].open(aq[4],"r"),""::av::u=aq[1].read(as,math.huge)if u then at=at..u;goto av end;computer.pullSignal=f;aq[1].close(as)if b then an()end;Z(ap(aq,1),F,.5,F,F,1)if J.getData()~=aq[3]then J.setData(aq[3])end;au,v=q(at,"="..aq[4])if not au then a5(v)end;return 1 end end;local function aw(ax,N,ay,az,aA)return{e=ax,s=1,y=N,k=az,b=ay,d=function(aB,aC,aD)N=aB.y;ay=aB.b;R(1,N-1,j,3," ",0x002b36)h=aD and h or aB;local aE,aF,aG,M,aH,aI=0,ay==1 and 6 or 8;if aA then aA(aB)end;for a4=1,#aB.e do aE=aE+unicode.len(aB.e[a4].t)+aF end;aE=aE-aF;M=W(aE)for a4=1,#aB.e do aH,aI=aB.s==a4 and 1,aB.e[a4]aG=unicode.len(aI.t)if aH and not aC then R(M-aF/2,N-(ay==1 and 0 or 1),aG+aF,ay==1 and 1 or 3," ",0x8cb9c5)L(M,N,aI.t,0x8cb9c5,0x002b36)else L(M,N,aI.t,0x002b36,0x8cb9c5)end;M=M+aG+aF end end}end;local function aJ()an()::aK::internet=o"et"a7()local t,G,r,at,aL,aM,aN,aq,o,aO,aP,aQ,as,u,aR,aS,H=setmetatable({print=am,proxy=o,os={sleep=function(l)B(l,F,function()error"interrupted"end)end}},{__index=_G})aL=aw({{t="Power off",a=function()computer.shutdown()end},{t="Lua",a=function()V()::av::at=ab("> ",1,k,F,F,at)if at then am("> "..at)L(1,k,">")am(select(2,q(at,"=stdin",t)))goto av end;aN(F,F,1,1)end}},i+2,1,function()h=aM;aN(1,1,F,F)end)aL.e[#aL.e+1]=internet and{t="Internet boot",a=function()aQ,at=ab("URL: ",F,i+7,1),""if aQ and aQ~=""then as,u=internet.request(aQ),""if as then Z"Downloading..."::av::u=as.read()if u then at=at..u;goto av end;as.close()Z(select(2,q(at,"=stdin"))or"is empty","Internet boot result",math.huge,0)else Z("Malformed URL","Internet boot result",math.huge,0)end end;aN(F,F,1,1)end}if#d>0 then aR=#aL.e+1;aM=aw({},i-2,2,function()h=aL;aN(F,F,1,1)end,function(aB)aq=d[aB.s]o=aq[1]aS=o.spaceTotal()aO=o.isReadOnly()R(1,i+5,j,3," ")Y(i+5,ap(aq),F,0xFFFFFF)Y(i+7,("Disk usage %s%% / %s / %s"):format(math.floor(o.spaceUsed()/(aS/100)),aO and"Read only"or"Read & Write",aS<2^20 and"FDD"or aS<2^20*12 and"HDD"or"RAID"))for a4=aR,#aL.e do aL.e[a4]=F end;if aO then aL.s=aL.s>#aL.e and#aL.e or aL.s else aL.e[aR]={t="Rename",a=function()aP=ab("New label: ",F,i+7,1)if aP and aP~=""then pcall(o.setLabel,aP)aq[2]=a9(aP,16)aM.e[aB.s].t=a9(aP,6)end;aM:d(1,1)aL:d()end}aL.e[#aL.e+1]={t="Format",a=function()aq[4]=F;o.remove("/")aM:d(1,1)aL:d()end}end;aL:d(1,1)end)for a4=1,#d do aM.e[a4]={t=a9(d[a4][2],6),a=function(aB)ar(d[aB.s])end}end else aL.y=i;aL.b=2 end;aN=function(aT,aU,aV,aW)V()if aM then aM:d(aV,aW)aL:d(aT,aU)else Y(i+4,"No drives available",0x002b36,0xFFFFFF)aL:d()end;Y(k,"Use ← ↑ → keys to move cursor; Enter to boot; CTRL+ALT+C to shutdown")end;aN(1,1)::av::G,H,H,r=computer.pullSignal(math.huge,computer.shutdown)if G=="key_down"then if r==200 then h.k()elseif r==208 then h.k()elseif r==203 then h.s=h.s>1 and h.s-1 or#h.e;h:d()elseif r==205 then h.s=h.s<#h.e and h.s+1 or 1;h:d()elseif r==28 then h.e[h.s].a(h)end elseif G:match("component")then goto aK end;goto av end;computer.beep(1000,.2)a7()Z("Hold CTRL to stay in bootloader",F,.5,29,aJ)for a4=1,#d do if ar(d[a4])then computer.shutdown()end end;if I and K then aJ()else error"No bootable medium found"end