local a,b,c,d,e,f,g,h,i,j,k="%pass%",%passOnBoot%,{"/init.lua","/OS.lua"},{},{},computer.pullSignal;computer.pullSignal=function(l,m)local n={f(l)}if n[1]=="key_down"then e[n[4]]=true elseif n[1]=="key_up"then e[n[4]]=nil end;if e[29]and e[56]and e[46]then if m then m()end;return"interrupted"elseif e[29]and e[32]then return"interrupted"else return table.unpack(n)end end;local function o(p)local address=component.list(p)()return address and component.proxy(address)end;local function q(r,s,t)local u,v=load("return "..r,s,false,t)if not u then u,v=load(r,s,false,t)end;if u then return xpcall(u,debug.traceback)else return false,v end end;local function w(x,y)local z={}for A in x:gmatch"[^\r\n]+"do z[#z+1]=A:gsub("\t",y and"    "or"")end;return z end;local function B(l,C,D)local E,F,r,G=computer.uptime()+(l or math.huge)repeat F,G,G,r=computer.pullSignal(E-computer.uptime())if F=="interrupted"or F=="key_down"and(r==C or C==0)then if D then D()end;return true end until computer.uptime()>=E end;local H,I,J=o"gpu"or{},o"eeprom",component.list"screen"()computer.setBootAddress=I.setData;computer.getBootAddress=I.getData;if H and J then H.bind(J)j,k=H.maxResolution()i=k/2;H.setPaletteColor(9,0x002b36)H.setPaletteColor(11,0x8cb9c5)end;local function K(L,M,N,O,P)H.setBackground(O or 0x002b36)H.setForeground(P or 0x8cb9c5)H.set(L,M,N)end;local function Q(L,M,R,S,T,O,P)H.setBackground(O or 0x002b36)H.setForeground(P or 0x8cb9c5)H.fill(L,M,R,S,T)end;local function U()Q(1,1,j,k," ")end;local function V(W)return math.ceil(j/2-W/2)end;local function X(M,x,O,P)K(V(unicode.len(x)),M,x,O,P)end;local function Y(x,Z,_,C,D,a0,a1)if H and J then local z,M,a2=w(x),computer.uptime()+(_ or 0),H.set;M=math.ceil(i-#z/2)H.setPaletteColor(9,0x002b36)H.setPaletteColor(11,0x8cb9c5)U()if Z then X(M-1,Z,0x002b36,0xFFFFFF)M=M+1 end;for a3=1,#z do X(M,z[a3])M=M+1 end;if a0 and H and J then H.set=function(...)H.setPaletteColor(9,0x969696)H.setPaletteColor(11,0xb4b4b4)a2(...)H.set=a2 end end;if a1 then computer.beep(1000,.4)computer.beep(1000,.4)end;return B(_ or 0,C,D)end end;local function a4(v)return H and J and Y(v,[[¯\_(ツ)_/¯]],math.huge,0,computer.shutdown,true)or error(v)end;local function a5(address)local o=component.proxy(address)if o and o.spaceTotal then d[#d+1]={o,o.getLabel()or"N/A",address}for a3=1,#c do if o.exists(c[a3])then d[#d][4]=c[a3]end end end end;local function a6()d={}a5(I.getData())for a7 in pairs(component.list("filesystem"))do a5(I.getData()~=a7 and computer.tmpAddress()~=a7 and a7 or"")end end;local function a8(x,a9)return unicode.len(x)>a9 and unicode.sub(x,1,a9).."…"or x end;local function aa(ab,ac,M,ad,ae,af)local aa,ag,ah,ai,L,aj,F,ak,r,G="",unicode.len(ab),1,true;while true do F,G,ak,r=computer.pullSignal(.5)if F=="interrupted"then aa=false;break elseif F=="key_down"then if ak>=32 and unicode.len(ag..aa)<j-ag-1 then aa=unicode.sub(aa,1,ah-1)..unicode.char(ak)..unicode.sub(aa,ah,-1)ah=ah+1 elseif ak==8 and#aa>0 then aa=unicode.sub(unicode.sub(aa,1,ah-1),1,-2)..unicode.sub(aa,ah,-1)ah=ah-1 elseif ak==13 then break elseif r==203 and ah>1 then ah=ah-1 elseif r==205 and ah<=unicode.len(aa)then ah=ah+1 elseif r==200 and af then aa=af;ah=unicode.len(af)+1 elseif r==208 and af then aa=""ah=true end;ai=true elseif F=="clipboard"then aa=unicode.sub(aa,1,ah-1)..ak..unicode.sub(aa,ah,-1)ah=ah+unicode.len(ak)elseif F~="key_up"then ai=not ai end;L=ad and V(unicode.len(aa)+ag)or ac;aj=L+ag+ah-1;Q(1,M,j,1," ")K(L,M,ab..(ae and("*"):rep(unicode.len(aa))or aa),0x002b36,0xFFFFFF)if aj<=j then K(aj,M,H.get(aj,M),ai and 0xFFFFFF or 0x002b36,ai and 0x002b36 or 0xFFFFFF)end end;Q(1,M,j,1," ")return aa end;local function al(...)local x,z=table.pack(...)for a3=1,x.n do x[a3]=tostring(x[a3])end;z=w(table.concat(x,"    "),true)for a3=1,#z do H.copy(1,1,j,k-1,0,-1)Q(1,k-1,j,1," ")K(1,k-1,z[a3])end end;local function am()if#a>0 and not g then local an=aa("Password: ",false,i,1,1)if not an then computer.shutdown()elseif an~=a then a4("Access denied")end;g=true end end;local function ao(ap,a0)address=a8(ap[3],a0 and 36 or 6)return ap[4]and("Boot%s %s from %s (%s)"):format(a0 and"ing"or"",ap[4],ap[2],address)or("Boot from %s (%s) is not available"):format(ap[2],address)end;local function aq(ap)if ap[4]then local ar,as,u,at,v=ap[1].open(ap[4],"r"),""::au::u=ap[1].read(ar,math.huge)if u then as=as..u;goto au end;computer.pullSignal=f;ap[1].close(ar)if b then am()end;Y(ao(ap,true),false,.5,false,false,true)if I.getData()~=ap[3]then I.setData(ap[3])end;I.get=I.getData;at,v=q(as,"="..ap[4])if not at then a4(v)end;return true end end;local function av(aw,M,ax,ay,az)return{e=aw,s=1,y=M,k=ay,b=ax,d=function(aA,aB,aC)M=aA.y;ax=aA.b;Q(1,M-1,j,3," ",0x002b36)h=aC and h or aA;local aD,aE,aF,L,aG,aH=0,ax==1 and 6 or 8;if az then az(aA)end;for a3=1,#aA.e do aD=aD+unicode.len(aA.e[a3].t)+aE end;aD=aD-aE;L=V(aD)for a3=1,#aA.e do aG,aH=aA.s==a3 and true,aA.e[a3]aF=unicode.len(aH.t)if aG and not aB then Q(L-aE/2,M-(ax==1 and 0 or 1),aF+aE,ax==1 and 1 or 3," ",0x8cb9c5)K(L,M,aH.t,0x8cb9c5,0x002b36)else K(L,M,aH.t,0x002b36,0x8cb9c5)end;L=L+aF+aE end end}end;local function aI()am()::aJ::internet=o"internet"a6()local t,F,r,as,aK,aL,aM,ap,o,aN,aO,aP,ar,u,aQ,aR,G=setmetatable({print=al,proxy=o,os={sleep=function(l)B(l,false,function()error("interrupted")end)end}},{__index=_G})aK=av({{t="Power off",a=function()computer.shutdown()end},{t="Lua 5.3",a=function()U()::au::as=aa("> ",1,k,false,false,as)if as then al("> "..as)K(1,k,">")al(select(2,q(as,"=stdin",t)))goto au end;aM(false,false,true,true)end}},i+2,1,function()h=aL;aM(true,true,false,false)end)aK.e[#aK.e+1]=internet and{t="Internet boot",a=function()aP,as=aa("URL: ",false,i+7,true),""if aP and aP~=""then ar,u=internet.request(aP),""if ar then Y("Downloading...")::au::u=ar.read()if u then as=as..u;goto au end;ar.close()Y(select(2,q(as,"=internet boot"))or"is empty","Internet boot result",math.huge,0)else Y("Malformed URL","Internet boot result",math.huge,0)end end;aM(false,false,true,true)end}if#d>0 then aQ=#aK.e+1;aL=av({},i-2,2,function()h=aK;aM(false,false,true,true)end,function(aA)ap=d[aA.s]o=ap[1]aR=o.spaceTotal()aN=o.isReadOnly()Q(1,i+5,j,3," ")X(i+5,ao(ap),false,0xFFFFFF)X(i+7,("Disk usage %s%% / %s / %s"):format(math.floor(o.spaceUsed()/(aR/100)),aN and"Read only"or"Read & Write",aR<2^20 and"FDD"or"HDD"))for a3=aQ,#aK.e do aK.e[a3]=nil end;if aN then aK.s=#aK.e else aK.e[aQ]={t="Rename",a=function()aO=aa("New label: ",false,i+7,true)if aO and aO~=""then pcall(o.setLabel,aO)ap[2]=a8(aO,16)aL.e[aA.s].t=a8(aO,6)end;aL:d(true,true)aK:d()end}aK.e[#aK.e+1]={t="Format",a=function()ap[4]=false;o.remove("/")aL:d(true,true)aK:d()end}end;aK:d(true,true)end)for a3=1,#d do aL.e[a3]={t=a8(d[a3][2],6),a=function(aA)aq(d[aA.s])end}end else aK.y=i;aK.b=2 end;aM=function(aS,aT,aU,aV)U()if aL then aL:d(aU,aV)aK:d(aS,aT)else X(i+4,"No drives available",0x002b36,0xFFFFFF)aK:d()end;X(k,"Use ← ↑ → keys to move cursor; Enter to boot; CTRL+ALT+C to shutdown")end;aM(true,true)::au::F,G,G,r=computer.pullSignal(math.huge,computer.shutdown)if F=="key_down"then if r==200 then h.k()elseif r==208 then h.k()elseif r==203 and h.s>1 then h.s=h.s-1;h:d()elseif r==205 and h.s<#h.e then h.s=h.s+1;h:d()elseif r==28 then h.e[h.s].a(h)end elseif F=="component_added"or F=="component_removed"then goto aJ end;goto au end;computer.beep(1000,.2)a6()Y("Hold CTRL to stay in bootloader",false,.5,29,aI)for a3=1,#d do if aq(d[a3])then computer.shutdown()end end;if H and J then aI()else error("No bootable medium found")end