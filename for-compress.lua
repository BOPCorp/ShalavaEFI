local a,b,c,d,e,f,g,h,i,j,k,l="%pass%",%passOnBoot%,{"/init.lua","/OS.lua"},{},{},computer.pullSignal;computer.pullSignal=function(m,n)local o={f(m)}if o[1]=="key_down"then e[o[4]]=true elseif o[1]=="key_up"then e[o[4]]=nil end;if e[29]and e[56]and e[46]then if n then n()end;return"interrupted"elseif e[29]and e[32]then return"interrupted"else return table.unpack(o)end end;local function p(q)local address=component.list(q)()return address and component.proxy(address)end;local function r(s,t,u)local v,w=load("return "..s,t,false,u)if not v then v,w=load(s,t,false,u)end;if v then return xpcall(v,debug.traceback)else return false,w end end;local function x(y,z)local A={}for B in y:gmatch"[^\r\n]+"do A[#A+1]=B:gsub("\t",z and"    "or"")end;return A end;local function C(m,D,E)local F,G,s,H=computer.uptime()+(m or math.huge)repeat G,H,H,s=computer.pullSignal(F-computer.uptime())if G=="interrupted"or G=="key_down"and(s==D or D==0)then if E then E()end;return true end until computer.uptime()>=F end;local I,J,K=p"gpu"or{},p"eeprom",component.list"screen"()computer.setBootAddress=J.setData;computer.getBootAddress=J.getData;if I and K then I.bind(K)j,k=I.maxResolution()i=k/2;I.setPaletteColor(9,0x002b36)I.setPaletteColor(11,0x8cb9c5)end;local function L(M,N,O,P,Q)I.setBackground(P or 0x002b36)I.setForeground(Q or 0x8cb9c5)I.set(M,N,O)end;local function R(M,N,S,T,U,P,Q)I.setBackground(P or 0x002b36)I.setForeground(Q or 0x8cb9c5)I.fill(M,N,S,T,U)end;local function V()R(1,1,j,k," ")end;local function W(X)return math.ceil(j/2-X/2)end;local function Y(N,y,P,Q)L(W(unicode.len(y)),N,y,P,Q)end;local function Z(y,_,a0,D,E,a1)if I and K then local A,N,a2=x(y),computer.uptime()+(a0 or 0),I.set;N=math.ceil(i-#A/2)I.setPaletteColor(9,0x002b36)I.setPaletteColor(11,0x8cb9c5)V()if _ then Y(N-1,_,0x002b36,0xFFFFFF)N=N+1 end;for a3=1,#A do Y(N,A[a3])N=N+1 end;if a1 and I and K then I.set=function(...)I.setPaletteColor(9,0x969696)I.setPaletteColor(11,0xb4b4b4)a2(...)I.set=a2 end end;return C(a0 or 0,D,E)end end;function l(w)computer.beep(1000,.4)computer.beep(1000,.4)return I and K and Z(w,[[¯\_(ツ)_/¯]],math.huge,0,computer.shutdown)or error(w)end;local function a4(address)local p=component.proxy(address)if p and p.spaceTotal then d[#d+1]={p,p.getLabel()or"N/A",address}for a3=1,#c do if p.exists(c[a3])then d[#d][4]=c[a3]end end end end;local function a5()d={}a4(J.getData())for a6 in pairs(component.list("filesystem"))do a4(J.getData()~=a6 and computer.tmpAddress()~=a6 and a6 or"")end end;local function a7(y,a8)return unicode.len(y)>a8 and unicode.sub(y,1,a8).."…"or y end;local function a9(aa,ab,N,ac,ad,ae)local a9,af,ag,ah,M,ai,G,aj,s,H="",unicode.len(aa),1,true;while true do G,H,aj,s=computer.pullSignal(.5)if G=="interrupted"then a9=false;break elseif G=="key_down"then if aj>=32 and unicode.len(af..a9)<j-af-1 then a9=unicode.sub(a9,1,ag-1)..unicode.char(aj)..unicode.sub(a9,ag,-1)ag=ag+1 elseif aj==8 and#a9>0 then a9=unicode.sub(unicode.sub(a9,1,ag-1),1,-2)..unicode.sub(a9,ag,-1)ag=ag-1 elseif aj==13 then break elseif s==203 and ag>1 then ag=ag-1 elseif s==205 and ag<=unicode.len(a9)then ag=ag+1 elseif s==200 and ae then a9=ae;ag=unicode.len(ae)+1 elseif s==208 and ae then a9=""ag=true end;ah=true elseif G=="clipboard"then a9=unicode.sub(a9,1,ag-1)..aj..unicode.sub(a9,ag,-1)ag=ag+unicode.len(aj)elseif G~="key_up"then ah=not ah end;M=ac and W(unicode.len(a9)+af)or ab;ai=M+af+ag-1;R(1,N,j,1," ")L(M,N,aa..(ad and("*"):rep(unicode.len(a9))or a9),0x002b36,0xFFFFFF)if ai<=j then L(ai,N,I.get(ai,N),ah and 0xFFFFFF or 0x002b36,ah and 0x002b36 or 0xFFFFFF)end end;R(1,N,j,1," ")return a9 end;local function ak(...)local y,A=table.pack(...)for a3=1,y.n do y[a3]=tostring(y[a3])end;A=x(table.concat(y,"    "),true)for a3=1,#A do I.copy(1,1,j,k-1,0,-1)R(1,k-1,j,1," ")L(1,k-1,A[a3])end end;local function al()if#a>0 and not g then local am=a9("Password: ",false,i,1,1)if not am then computer.shutdown()elseif am~=a then l("Access denied")end;g=true end end;local function an(ao,a1)address=a7(ao[3],a1 and 36 or 6)return ao[4]and("Boot%s %s from %s (%s)"):format(a1 and"ing"or"",ao[4],ao[2],address)or("Boot from %s (%s) is not available"):format(ao[2],address)end;local function ap(ao)if ao[4]then local aq,ar,v,as,w=ao[1].open(ao[4],"r"),""::at::v=ao[1].read(aq,math.huge)if v then ar=ar..v;goto at end;computer.pullSignal=f;ao[1].close(aq)if b then al()end;Z(an(ao,true),false,.5,false,false,true)if J.getData()~=ao[3]then J.setData(ao[3])end;J.get=J.getData;as,w=r(ar,"="..ao[4])if not as then l(w)end;return true end end;local function au(av,N,aw,ax,ay)return{e=av,s=1,y=N,k=ax,b=aw,d=function(az,aA,aB)N=az.y;aw=az.b;R(1,N-1,j,3," ",0x002b36)h=aB and h or az;local aC,aD,aE,M,aF,aG=0,aw==1 and 6 or 8;if ay then ay(az)end;for a3=1,#az.e do aC=aC+unicode.len(az.e[a3].t)+aD end;aC=aC-aD;M=W(aC)for a3=1,#az.e do aF,aG=az.s==a3 and true,az.e[a3]aE=unicode.len(aG.t)if aF and not aA then R(M-aD/2,N-(aw==1 and 0 or 1),aE+aD,aw==1 and 1 or 3," ",0x8cb9c5)L(M,N,aG.t,0x8cb9c5,0x002b36)else L(M,N,aG.t,0x002b36,0x8cb9c5)end;M=M+aE+aD end end}end;local function aH()al()::aI::internet=p"internet"a5()local u,G,s,ar,aJ,aK,aL,ao,p,aM,aN,aO,aq,v,aP,aQ,H=setmetatable({print=ak,proxy=p,os={sleep=function(m)C(m,false,function()error("interrupted")end)end}},{__index=_G})aJ=au({{t="Power off",a=function()computer.shutdown()end},{t="Lua 5.3",a=function()V()::at::ar=a9("> ",1,k,false,false,ar)if ar then ak("> "..ar)L(1,k,">")ak(select(2,r(ar,"=stdin",u)))goto at end;aL(false,false,true,true)end}},i+2,1,function()h=aK;aL(true,true,false,false)end)aJ.e[#aJ.e+1]=internet and{t="Internet boot",a=function()aO,ar=a9("URL: ",false,i+7,true),""if aO and aO~=""then aq,v=internet.request(aO),""if aq then Z("Downloading...")::at::v=aq.read()if v then ar=ar..v;goto at end;aq.close()Z(select(2,r(ar,"=internet boot"))or"is empty","Internet boot result",math.huge,0)else Z("Malformed URL","Internet boot result",math.huge,0)end end;aL(false,false,true,true)end}if#d>0 then aP=#aJ.e+1;aK=au({},i-2,2,function()h=aJ;aL(false,false,true,true)end,function(az)ao=d[az.s]p=ao[1]aQ=p.spaceTotal()aM=p.isReadOnly()R(1,i+5,j,3," ")Y(i+5,an(ao),false,0xFFFFFF)Y(i+7,("Disk usage %s%% / %s / %s"):format(math.floor(p.spaceUsed()/(aQ/100)),aM and"Read only"or"Read & Write",aQ<2^20 and"FDD"or"HDD"))for a3=aP,#aJ.e do aJ.e[a3]=nil end;if aM then aJ.s=#aJ.e else aJ.e[aP]={t="Rename",a=function()aN=a9("New label: ",false,i+7,true)if aN and aN~=""then pcall(p.setLabel,aN)ao[2]=a7(aN,16)aK.e[az.s].t=a7(aN,6)end;aK:d(true,true)aJ:d()end}aJ.e[#aJ.e+1]={t="Format",a=function()ao[4]=false;p.remove("/")aK:d(true,true)aJ:d()end}end;aJ:d(true,true)end)for a3=1,#d do aK.e[a3]={t=a7(d[a3][2],6),a=function(az)ap(d[az.s])end}end else aJ.y=i;aJ.b=2 end;aL=function(aR,aS,aT,aU)V()if aK then aK:d(aT,aU)aJ:d(aR,aS)else Y(i+4,"No drives available",0x002b36,0xFFFFFF)aJ:d()end;Y(k,"Use ← ↑ → keys to move cursor; Enter to boot; CTRL+ALT+C to shutdown")end;aL(true,true)::at::G,H,H,s=computer.pullSignal(math.huge,computer.shutdown)if G=="key_down"then if s==200 then h.k()elseif s==208 then h.k()elseif s==203 and h.s>1 then h.s=h.s-1;h:d()elseif s==205 and h.s<#h.e then h.s=h.s+1;h:d()elseif s==28 then h.e[h.s].a(h)end elseif G=="component_added"or G=="component_removed"then goto aI end;goto at end;computer.beep(1000,.2)a5()Z("Hold CTRL to stay in bootloader",false,.5,29,aH)for a3=1,#d do if ap(d[a3])then computer.shutdown()end end;if I and K then aH()else error("No bootable medium found")end