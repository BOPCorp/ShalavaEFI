print(coroutine)error()local a,b,c,d,e,f,g,h,i,j,k,l,m,n,o=component,computer,unicode,{"/init.lua","/OS.lua"},{},{}local function p(q,r,s,t,u)u=u or xpcall;local v,w=load("return "..q,r,F,s)if not v then v,w=load(q,r,F,s)end;if v then s=a.invoke;a.invoke=t and function(x,y,...)if k and x==k.address and y=="set"then k.setPaletteColor(9,0x969696)k.setPaletteColor(11,0xb4b4b4)a.invoke=s end;return s(x,y,...)end or s;return u(v,debug.traceback)end;return F,w end;local function z(A)return a.list(A)()and a.proxy(a.list(A)())end;local function B(C,D)n={}for E in C:gmatch"[^\r\n]+"do n[#n+1]=E:gsub("\t",D and"    "or"")end end;local function G(H,I,J,K,L)k.setBackground(K or 0x002b36)k.setForeground(L or 0x8cb9c5)k.set(H,I,J)end;local function M(H,I,N,O,K,L)k.setBackground(K or 0x002b36)k.setForeground(L or 0x8cb9c5)k.fill(H,I,N,O," ")end;local function P()M(1,1,i,j)end;local function Q(R)return math.floor(i/2-R/2)end;local function S(I,C,K,L)G(Q(c.len(C)),I,C,K,L)end;local function T()k,l=z"gp",z"sc"if k and l then if k.getScreen()~=l.address then k.bind(l.address)end;local U,V,W=l.getAspectRatio()i,j=k.maxResolution()W=2*(16*U-4.5)/(16*V-4.5)if W>i/j then j=math.floor(i/W)else i=math.floor(j*W)end;k.set(1,1,"")k.setResolution(i,j)k.setPaletteColor(9,0x002b36)k.setPaletteColor(11,0x8cb9c5)end end;local function X(Y)local Z={b.pullSignal(Y)}Z[1]=Z[1]or""if cyan and cyan[1].n>0 and(Z[1]:match("ey")and not cyan[1][Z[5]]or Z[1]:match("cl")and not cyan[1][Z[4]])then return""end;f[Z[4]or""]=Z[1]:match"do"and 1;if f[29]and(f[46]or f[32])and Z[1]:match"do"then return"F"end;return table.unpack(Z)end;local function _(Y,a0,a1)local a2,a3,q,a4=b.uptime()+(Y or math.huge)::a5::a3,a4,a4,q=X(a2-b.uptime())if a3=="F"or a3:match"do"and(q==a0 or a0==0)then return 1,a1 and a1()elseif b.uptime()<a2 then goto a5 end end;local function a6(C,a7,a8,a0,a1)if k and l then P()B(C)local I=math.ceil(j/2-#n/2)if a7 then S(I-1,a7,0x002b36,0xffffff)I=I+1 end;for a9=1,#n do S(I,n[a9])I=I+1 end;_(a8 or 0,a0 or 0,a1)end end;local function aa(C,ab)return c.len(C)>ab and c.sub(C,1,ab).."…"or C end;local function ac(ad,I,ae,af,L,s)local C,ag,ah,ai,aj,H,a3,ak,q,a4="",c.len(ad),1,1;L=L or 0x8cb9c5::a5::H=ae and Q(c.len(C)+ag)or 1;aj=H+ag+ah-1;M(1,I,i,1)G(H,I,ad..C,F,L)if aj<=i then G(aj,I,k.get(aj,I),ai and L or 0x002b36,ai and 0x002b36 or L)end;a3,a4,ak,q=X(.5)if a3:match"do"then if q==203 and ah>1 then ah=ah-1 elseif q==205 and ah<=c.len(C)then ah=ah+1 elseif q==200 and af then C=af;ah=c.len(af)+1 elseif q==208 and af then C=""ah=1 elseif q==14 and#C>0 and ah>1 then C=f[29]and""or c.sub(c.sub(C,1,ah-1),1,-2)..c.sub(C,ah,-1)ah=f[29]and 1 or ah-1 elseif q==28 then return C elseif ak>=32 and c.len(ag..C)<i-ag then C=c.sub(C,1,ah-1)..c.char(ak)..c.sub(C,ah,-1)ah=ah+1 end;ai=1 elseif a3:match"cl"then C=c.sub(C,1,ah-1)..ak..c.sub(C,ah,-1)ah=ah+c.len(ak)elseif a3:match"mp"or a3=="F"then m=a3:match"mp"and 1;return elseif not a3:match"up"then ai=not ai end;goto a5 end;local function print(...)local C=table.pack(...)for a9=1,C.n do C[a9]=tostring(C[a9])end;B(table.concat(C,"    "),1)for a9=1,#n do k.copy(1,1,i,j-1,0,-1)M(1,j-1,i,1)G(1,j-1,n[a9])end end;local function al(x)local z,am,a9=a.proxy(x)if z and x~=b.tmpAddress()then a9=#e+1;for an=1,#d do if z.exists(d[an])then am=d[an]break end end;e[a9]={r=z,p=function(ao,I)ao=ao and P()or ao;S(I or j/2,am and("Boot%s %s from %s (%s)"):format(ao and"ing"or"",am,aa(z.getLabel()or"N/A",6),aa(x,ao and i>80 and 36 or 6))or("Boot from %s (%s) isn't available"):format(z.getLabel()or"N/A",aa(x,ao and i>80 and 36 or 6)),F,not ao and 0xffffff)ao=ao and not g and a6"Hold ENTER to boot"and _(math.huge,28)end}e[a9].b=function()if am then local ap,aq,v,ar,w=z.open(am,"r"),""::a5::v=z.read(ap,math.huge)if v then aq=aq..v;goto a5 end;z.close(ap)pcall(e[a9].p,1)v=h~=x and b.setBootAddress(x)ar,w=p(aq,"="..am,F,1)ar=ar and b.shutdown()T()a6(w,"¯\\_(ツ)_/¯",math.huge,0,b.shutdown)error(w)end end or b.uptime;o[a9]={aa(z.getLabel()or"N/A",6),e[a9].b}end end;local function as(at)e={}o={s=at or 1}al(h)for x in next,a.list"file"do al(x~=h and x or"")end end;local function au()g=1::av::local aw,ax,ay,az,aA,a3,q,aB,aq,aC,I,aD,s,a4=function(aE,I,aF,aG,aH,aI)local aJ,H=0;for a9=1,#aE do aJ=aJ+c.len(aE[a9][1])+aF end;aJ=aJ-aF;H=Q(aJ)if aI then aI()end;for a9=1,#aE do if aE.s==a9 and aH then M(H-aF/2,I-math.floor(aG/2),c.len(aE[a9][1])+aF,aG,0x8cb9c5)G(H,I,aE[a9][1],0x8cb9c5,0x002b36)else G(H,I,aE[a9][1],0x002b36,0x8cb9c5)end;H=H+c.len(aE[a9][1])+aF end end;function az()I=j/2-(#e>0 and-1 or 1)P()aw(o,I-4,8,3,not aA.p and 1,function()if#e>0 then aD=e[o.s].r;e[o.s].p(F,I+3)S(I+5,("Storage %s%% / %s / %s"):format(math.floor(aD.spaceUsed()/(aD.spaceTotal()/100)),aD.isReadOnly()and"Read only"or"Read & Write",aD.spaceTotal()<2^20 and"FDD"or aD.spaceTotal()<2^20*12 and"HDD"or"RAID"))for a9=ax,#ay do ay[a9]=F end;if not aD.isReadOnly()then ay[ax]={"Rename",function()P()S(j/2-1,"Change label",F,0xffffff)aB=ac("Enter new name: ",j/2+1,1,F,0x8cb9c5)if aB and#aB>0 then aD.setLabel(aB)as(o.s)end end}ay[ax+1]={"Format",function()aD.remove("/")aD.setLabel(F)as(o.s)end}end else S(I+3,"No drives available",F,0xffffff)end end)aw(ay,I,6,1,aA.p and 1 or F)end;ay={s=1,p=1,{"Halt",b.shutdown},{"Shell",function()P()s=setmetatable({print=print,proxy=z,function(Y)_(Y,0)end},{__index=_G})::a5::aq=ac("> ",j,F,aq,0xffffff,s)if aq then print("> "..aq)M(1,j,i,1)G(1,j,">")print(select(2,p(aq,"=shell",s)))goto a5 end end},z"net"and{"Netboot",function()P()S(j/2-1,"Internet boot",F,0xffffff)aC=ac("URL: ",j/2+1,1,F,0x8cb9c5)if aC and#aC>0 then local ap,aq,v=z"net".request(aC,F,F,{["user-agent"]="Cyan"}),""if ap then a6("Downloading script...","Internet boot")::a5::v=ap.read()if v then aq=aq..v;goto a5 end;aq=select(2,p(aq,"=stdin",F,1,pcall))or""a6(aq,"Internet boot",#aq==0 and 0 or math.huge)else a6("Invalid URL","Internet boot",math.huge)end end end}}ax=#ay+1;m=F;as()aA=#e>0 and o or ay::a5::pcall(az)a3,a4,a4,q=X()if a3=="F"then b.shutdown()else if a3:match"do"then aA=(q==200 or q==208)and(#e>0 and(aA.p and o or ay)or aA)or aA;aA.s=q==203 and(aA.s==1 and#aA or aA.s-1)or q==205 and(aA.s==#aA and 1 or aA.s+1)or aA.s;if q==28 then pcall(aA[aA.s][2])end end;if a3:match"mp"or m then pcall(T)goto av end end;goto a5 end;b.getBootAddress=z"pro".getData;b.setBootAddress=z"pro".setData;h=b.getBootAddress()g=(not cyan or not cyan[2])and 1;as()T()a6("Hold ALT to stay in bootloader",F,1,56,au)for a9=1,#e do e[a9].b()end;k=k and l and au()or error("No drives available")