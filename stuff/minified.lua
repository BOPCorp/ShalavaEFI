local a,b,c,d,e,f,g,h,i,j={"/init.lua","OS.lua"},{},{}local function k(l)local m={computer.pullSignal(l)}m[1]=m[1]or""c[m[4]or""]=m[1]:match"do"and 1;if c[29]and(c[46]or c[32])and m[1]:match"do"then return"F"end;return table.unpack(m)end;local function n(o,p,q,r)local s,t=load("return "..o,p,F,q)if not s then s,t=load(o,p,F,q)end;if s then q=component.invoke;component.invoke=r and g and g.address and function(u,v,...)if g and u==g.address and v=="set"then g.setPaletteColor(9,0x969696)g.setPaletteColor(11,0xb4b4b4)end;component.invoke=q;return q(u,v,...)end or q;return xpcall(s,debug.traceback)end;return F,t end;local function w(x)return component.list(x)()and component.proxy(component.list(x)())end;local function y(z,A)i={}for B in z:gmatch"[^\r\n]+"do i[#i+1]=B:gsub("\t",A and"    "or"")end end;local function C(l,D,E)local G,H,o,I=computer.uptime()+(l or math.huge)::J::H,I,I,o=k(G-computer.uptime())if H=="F"or H:match"do"and(o==D or D==0)then return 1,E and E()elseif computer.uptime()<=G then goto J end end;local function K(L,M,N,O,P)g.setBackground(O or 0x002b36)g.setForeground(P or 0x8cb9c5)g.set(L,M,N)end;local function Q(L,M,R,S,O,P)g.setBackground(O or 0x002b36)g.setForeground(P or 0x8cb9c5)g.fill(L,M,R,S," ")end;local function T()Q(1,1,e,f)end;local function U(V)return math.ceil(e/2-V/2)end;local function W(M,z,O,P)K(U(unicode.len(z)),M,z,O,P)end;local function X()g=w"gp"if g and g.bind(component.list"sc"())then g.setPaletteColor(9,0x002b36)g.setPaletteColor(11,0x8cb9c5)e,f=g.maxResolution()T()return 1 end;e,f=0,0 end;local function Y(z,Z,_,D,E,t,a0)if a0 then E()elseif X()then y(z)local M=math.ceil(f/2-#i/2)if Z then W(M-1,Z,0x002b36,0xFFFFFF)M=M+1 end;for a1=1,#i do W(M,i[a1])M=M+1 end;return C(_ or 0,D,E)elseif t then error(z)end end;local function a2(z,a3)return unicode.len(z)>a3 and unicode.sub(z,1,a3).."…"or z end;local function a4(a5,a6,M,a7,a8)local a4,a9,aa,ab,ac,L,ad,H,ae,o,I="",unicode.len(a5),1,1::J::H,I,ae,o=k(ab and 0 or 0.5)if H:match"do"then if ae>=32 and unicode.len(a9 ..a4)<e-a9 then a4=unicode.sub(a4,1,aa-1)..unicode.char(ae)..unicode.sub(a4,aa,-1)aa=aa+1 elseif ae==8 and#a4>0 and aa>1 then a4=unicode.sub(unicode.sub(a4,1,aa-1),1,-2)..unicode.sub(a4,aa,-1)aa=aa-1 elseif ae==13 then Q(1,M,e,1)return a4 elseif o==203 and aa>1 then aa=aa-1 elseif o==205 and aa<=unicode.len(a4)then aa=aa+1 elseif o==200 and a8 then a4=a8;aa=unicode.len(a8)+1 elseif o==208 and a8 then a4=""aa=1 end;ac=1 elseif H:match"cl"then a4=unicode.sub(a4,1,aa-1)..ae..unicode.sub(a4,aa,-1)aa=aa+unicode.len(ae)elseif H:match"mp"or H=="F"then h=H:match"mp"and 1;return elseif not H:match"up"then ac=not ac end;ab=F;L=a7 and U(unicode.len(a4)+a9)or a6;ad=L+a9+aa-1;Q(1,M,e,1)K(L,M,a5 ..a4,0x002b36,0xFFFFFF)if ad<=e then K(ad,M,g.get(ad,M),ac and 0xFFFFFF or 0x002b36,ac and 0x002b36 or 0xFFFFFF)end;goto J end;local function af(...)local z=table.pack(...)for a1=1,z.n do z[a1]=tostring(z[a1])end;y(table.concat(z,"    "),1)for a1=1,#i do g.copy(1,1,e,f-1,0,-1)Q(1,f-1,e,1)K(1,f-1,i[a1])end end;local function ag(u)local w,ah,a1=component.proxy(u)if w and u~=computer.tmpAddress()then a1=#b+1;for ai=1,#a do if w.exists(a[ai])then ah=a[ai]break end end;b[a1]={r=w,p=function(aj,M)W(M,ah and("Boot%s /%s from %s (%s)"):format(aj and"ing"or"",ah,a2(w.getLabel()or"N/A",6),a2(u,aj and e>80 and 36 or 6))or("Boot from /%s (%s) isn't available"):format(w.getLabel()or"N/A",a2(u,aj and e>80 and 36 or 6)),F,not aj and 0xFFFFFF)end}b[a1].b=function()local ak,al,s,am,t=w.open(ah,"r"),""::J::s=w.read(ak,math.huge)if s then al=al..s;goto J end;w.close(ak)Y("Hold any button to boot",F,math.huge,0,function()if g then T()b[a1].p(1,f/2)end;if computer.getBootAddress()~=u then computer.setBootAddress(u)end;am,t=n(al,"="..ah,setmetatable({},{__index=_G}),1)Y(t,[[¯\_(ツ)_/¯]],math.huge,0,computer.shutdown,t,am)end,F,1)end or computer.uptime;j[a1]={w.getLabel()or"N/A",b[a1].b}end end;local function an(ao)b={}j={s=ao or 1}ag(computer.getBootAddress())for u in next,component.list"file"do ag(u~=computer.getBootAddress()and u or"")end end;local function ap()d=1::aq::local ar,as,at,au,av,H,o,aw,al,ax,M,I=function(ay,M,az,aA,aB,aC)local aD,L=0;for a1=1,#ay do aD=aD+unicode.len(ay[a1][1])+az end;aD=aD-az;L=U(aD)if aC then aC()end;for a1=1,#ay do if ay.s==a1 and aB then Q(L-az/2,M-math.floor(aA/2),unicode.len(ay[a1][1])+az,aA,0x8cb9c5)K(L,M,ay[a1][1],0x8cb9c5,0x002b36)else K(L,M,ay[a1][1],0x002b36,0x8cb9c5)end;L=L+unicode.len(ay[a1][1])+az end end;au=function()M=f/2-(#b>0 and-1 or 1)T()ar(j,M-4,8,3,not av.p and 1,function()if#b>0 then I=b[j.s].r;b[j.s].p(F,M+3)W(M+5,("Storage %s%% / %s / %s"):format(math.floor(I.spaceUsed()/(I.spaceTotal()/100)),I.isReadOnly()and"Read only"or"Read & Write",I.spaceTotal()<2^20 and"FDD"or I.spaceTotal()<2^20*12 and"HDD"or"RAID"))for a1=as,#at do at[a1]=F end;if not I.isReadOnly()then at[as]={"Rename",function()Q(1,M+3,e,3)aw=a4("New label: ",F,M+3,1)if aw and#aw>0 then I.setLabel(aw)an(j.s)end end}at[as+1]={"Format",function()I.remove("/")I.setLabel(F)an(j.s)end}end else W(M+3,"No drives available",F,0xFFFFFF)end end)ar(at,M,6,1,av.p and 1 or F)end;at={s=1,p=1,{"Halt",computer.shutdown},{"Shell",function()T()I=setmetatable({print=af,proxy=w,sleep=C},{__index=_G})::J::al=a4("> ",1,f,F,al)if al then af("> "..al)K(1,f,">")af(select(2,n(al,"=shell",I)))goto J end end},{"URL boot",function()Q(1,M+3,e,3)ax=a4("URL: ",F,M+3,1)if ax and#ax>0 then local ak,al,s=w"net".request(ax,F,F,{["user-agent"]="Cyan"}),""if ak then Y"Downloading..."::J::s=ak.read()if s then al=al..s;goto J end;Y(select(2,n(al,"=URL boot",setmetatable({},{__index=_G}),1))or"is empty","URL boot",math.huge,0)else Y("Invalid URL","Internet boot",math.huge,0)end end end}}as=#at+1;h=F;X()an()av=#b>0 and j or at;au()::J::H,I,I,o=k()if H=="F"then computer.shutdown()elseif H:match"mp"or h then goto aq elseif H:match"do"then av=(o==200 or o==208)and(#b>0 and(av.p and j or at)or av)or av;av.s=o==203 and(av.s==1 and#av or av.s-1)or o==205 and(av.s==#av and 1 or av.s+1)or av.s;if o==28 then av[av.s][2]()end;au()end;goto J end;computer.getBootAddress=w"pro".getData;computer.setBootAddress=w"pro".setData;an()Y("Hold ALT to stay in bootloader",F,math.huge,56,ap,F)for a1=1,#b do b[a1].b()end;Y("No drives available",F,0,F,ap,F,1)