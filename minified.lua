local a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t={"/init.lua","/OS.lua"},{},{},unicode,computer,component,component.invoke;local function u(v)local w={e.pullSignal(v)}w[1]=w[1]or""if#w>0 and#t[2]>0 and(w[1]:match("ey")and not t[2][w[5]]or w[1]:match("cl")and not t[2][w[4]])then return""end;c[w[4]or""]=w[1]:match"do"and 1;if c[29]and(c[56]and c[46]or c[32])and w[1]:match"do"then return"F"end;return table.unpack(w)end;local function x(y,z,A)local B,C=load("return "..y,z,F,A)if not B then B,C=load(y,z,F,A)end;if B then return xpcall(B,debug.traceback)end;return F,C end;local function D(E)return f.list(E)()and f.proxy(f.list(E)())end;local function G(H,I)l={}for J in H:gmatch"[^\r\n]+"do l[#l+1]=J:gsub("\t",I and"    "or"")end end;local function K(L,...)if L and type(L):match("f")then return L(...)end end;local function M(v,N,O)local P,Q,y,R=e.uptime()+(v or math.huge)::S::Q,R,R,y=u(P-e.uptime())if Q=="F"or Q:match"do"and(y==N or N==0)then K(O)return 1 elseif e.uptime()<=P then goto S end end;local function T()o,n,q,m=D"gp",D"net",f.list"pro"(),f.list"sc"()if o and m then h=F;o.bind(m)o.setPaletteColor(9,0x002b36)o.setPaletteColor(11,0x8cb9c5)j,k=o.maxResolution()p=o.address;return 1 end end;T()r=g(q,"getData")s,t=x(r)t=type(t)=="table"and t or{#r==36 and r or"",{},0}t[2].t="{"for U=1,#t[2]do t[2][t[2][U]]=1;t[2].t=t[2].t..'"'..t[2][U]..'",'end;t[2].t=t[2].t.."}"function f.invoke(V,W,...)if V==q then if W=="setData"then t[1]=...or""return q and g(q or"","setData",("{'%s',%s,%s}"):format(...or"",t[2].t,t[3]))elseif W=="getData"then return t[1]elseif W=="getDataSize"then return 36 end elseif W=="set"and V==p and h then h=F;o.setPaletteColor(9,0x969696)o.setPaletteColor(11,0xb4b4b4)end;return g(V,W,...)end;e.setBootAddress=function(...)return f.invoke(q,"setData",...)end;e.getBootAddress=function(...)return f.invoke(q,"getData")end;local function X(Y,Z,_,a0,a1)o.setBackground(a0 or 0x002b36)o.setForeground(a1 or 0x8cb9c5)o.set(Y,Z,_)end;local function a2(Y,Z,a3,a4,a0,a1)o.setBackground(a0 or 0x002b36)o.setForeground(a1 or 0x8cb9c5)o.fill(Y,Z,a3,a4," ")end;local function a5()a2(1,1,j,k)end;local function a6(a7)return math.ceil(j/2-a7/2)end;local function a8(Z,H,a0,a1)X(a6(d.len(H)),Z,H,a0,a1)end;local function a9(H,aa,ab,N,O,C,ac)if ac then O()elseif T()then G(H)a5()local Z=math.ceil(k/2-#l/2)if aa then a8(Z-1,aa,0x002b36,0xFFFFFF)Z=Z+1 end;for U=1,#l do a8(Z,l[U])Z=Z+1 end;return M(ab or 0,N,O)elseif C then error(H)end end;local function ad(H,ae)return d.len(H)>ae and d.sub(H,1,ae).."…"or H end;local function af(ag,ah,Z,ai,aj)local af,ak,al,am,Y,an,Q,ao,y,R="",d.len(ag),1,1::S::Q,R,ao,y=u(.5)if Q:match"do"then if ao>=32 and d.len(ak..af)<j-ak then af=d.sub(af,1,al-1)..d.char(ao)..d.sub(af,al,-1)al=al+1 elseif ao==8 and#af>0 and al>1 then af=d.sub(d.sub(af,1,al-1),1,-2)..d.sub(af,al,-1)al=al-1 elseif ao==13 then a2(1,Z,j,1)return af elseif y==203 and al>1 then al=al-1 elseif y==205 and al<=d.len(af)then al=al+1 elseif y==200 and aj then af=aj;al=d.len(aj)+1 elseif y==208 and aj then af=""al=1 end;am=1 elseif Q:match"cl"then af=d.sub(af,1,al-1)..ao..d.sub(af,al,-1)al=al+d.len(ao)elseif Q:match"mp"or Q=="F"then s=Q:match"mp"and 1;return elseif not Q:match"up"then am=not am end;Y=ai and a6(d.len(af)+ak)or ah;an=Y+ak+al-1;a2(1,Z,j,1)X(Y,Z,ag..af,0x002b36,0xFFFFFF)if an<=j then X(an,Z,o.get(an,Z),am and 0xFFFFFF or 0x002b36,am and 0x002b36 or 0xFFFFFF)end;goto S end;local function ap(...)local H=table.pack(...)for U=1,H.n do H[U]=tostring(H[U])end;G(table.concat(H,"    "),1)for U=1,#l do o.copy(1,1,j,k-1,0,-1)a2(1,k-1,j,1)X(1,k-1,l[U])end end;local function aq(ar,as,Z,a1)a8(Z,ar[6]and("Boot%s %s from %s (%s)"):format(as and"ing"or"",ar[6],ar[2],ad(ar[3],as and j>80 and 36 or 6))or("Boot from %s (%s) is not available"):format(ar[2],ad(ar[3],as and j>80 and 36 or 6)),F,a1)end;local function at(V)local D=f.proxy(V)if D and D.spaceTotal and V~=e.tmpAddress()then b[#b+1]={D,D.getLabel()or"N/A",V,ad(D.getLabel()or"N/A",6),("Storage %s%% / %s / %s"):format(math.floor(D.spaceUsed()/(D.spaceTotal()/100)),D.isReadOnly()and"Read only"or"Read & Write",D.spaceTotal()<2^20 and"FDD"or D.spaceTotal()<2^20*12 and"HDD"or"RAID")}for U=1,#a do if D.exists(a[U])then b[#b][6]=a[U]break end end end end;local function au()b={}at(e.getBootAddress())for V in next,f.list"f"do at(V~=e.getBootAddress()and V or"")end end;local function av(ar)if ar[6]then local aw,ax,B,ay,C=ar[1].open(ar[6],"r"),""::S::B=ar[1].read(aw,math.huge)if B then ax=ax..B;goto S end;ar[1].close(aw)a9("Hold any button to boot",F,math.huge,0,function()if o and m then a5()aq(ar,1,k/2)end;if e.getBootAddress()~=ar[3]then e.setBootAddress(ar[3])end;h=1;ay,C=x(ax,"="..ar[6])a9(C,[[¯\_(ツ)_/¯]],math.huge,0,e.shutdown,C,ay)end,F,i or t[3]==0)end end;local function az()i=1::aA::s=F;T()au()local A,aB,Q,y,aC,aD,ax,aE,R;local function aF(aG,aH,aI,Z,aJ,aK)table.insert(aG.e,{s=1,y=Z,e=aH,o=aI,d=function(aL,aM)local aN,Y=0;for U=1,#aL.e do aL.e[U][3]=K(aL.e[U][1])or aL.e[U][1]aN=aN+d.len(aL.e[U][3])+aJ end;aN=aN-aJ;Y=a6(aN)for U=1,#aL.e do if aL.s==U and aM then a2(Y-aJ/2,aL.y-math.floor(aK/2),d.len(aL.e[U][3])+aJ,aK,0x8cb9c5)X(Y,aL.y,aL.e[U][3],0x8cb9c5,0x002b36)else X(Y,aL.y,aL.e[U][3],0x002b36,0x8cb9c5)end;Y=Y+d.len(aL.e[U][3])+aJ end end})return#aH end;local function aO(aI)return{s=1,e={},o=aI,d=function(aL)if o and m and not s then K(aL.o,aL)for U=1,#aL.e do aL.e[U]:d(aL.s==U)end end end,l=function(aL)::S::Q,R,R,y=u(0)if Q:match"mp"or s or Q=="F"then return Q elseif Q:match"do"then if y==200 then aL.s=aL.s>1 and aL.s-1 or#aL.e elseif y==208 then aL.s=aL.s<#aL.e and aL.s+1 or 1 elseif y==203 then aL.e[aL.s].s=aL.e[aL.s].s>1 and aL.e[aL.s].s-1 or#aL.e[aL.s].e elseif y==205 then aL.e[aL.s].s=aL.e[aL.s].s<#aL.e[aL.s].e and aL.e[aL.s].s+1 or 1 elseif y==28 then aL.e[aL.s].e[aL.e[aL.s].s][2]()end;aL:d()end;goto S end}end;aB=aO()if#b>0 then aF(aB,{},F,k/2-3,8,3)for U=1,#b do aB.e[1].e[U]={function()return b[U][4]end,function()av(b[U])end}end end;aC=aF(aB,{{"Halt",e.shutdown},{"Shell",function()a5()A=setmetatable({print=ap,proxy=D,os={sleep=function(v)M(v)end},read=function(aj)ap(" ")ax=af("",1,k-1,F,aj)X(1,k-1,ax or"")return ax end},{__index=_G})::S::ax=af("> ",1,k,F,ax)if ax then ap("> "..ax)X(1,k,">")ap(select(2,x(ax,"=stdin",A)))goto S end end},n and{"URL boot",function()aE=af("URL: ",F,k/2+6,1)if aE and#aE>0 then local aw,ax,B=n.request(aE,F,F,{["user-agent"]="Cyan"}),""if aw then a9"Downloading..."::S::B=aw.read()if B then ax=ax..B;goto S end;h=1;a9(select(2,x(ax,"=URL boot"))or"is empty","URL boot",math.huge,0)else a9("Invalid URL","Internet boot",math.huge,0)end end end}or F},F,k/2+(#b>0 and 1 or 0),#b>0 and 6 or 8,#b>0 and 1 or 3)+1;aB.o=function(aL)a5()if#b>0 then aq(b[aL.e[1].s],F,k/2+4,0xFFFFFF)a8(k/2+6,b[aL.e[1].s][5])for aP=aC,#aL.e[2].e do aL.e[2].e[aP]=F end;if not b[aL.e[1].s][7]then if b[aL.e[1].s][1].isReadOnly()then aL.e[2].s=aL.e[2].s>#aL.e[2].e and#aL.e[2].e or aL.e[2].s else aL.e[2].e[aC]={"Rename",function()aD=af("New label: ",F,k/2+6,1)if aD and#aD>0 then b[aL.e[1].s][1].setLabel(aD)au()end end}aL.e[2].e[aC+1]={"Format",function()b[aL.e[1].s][1].remove("/")b[aL.e[1].s][1].setLabel(F)au()end}end end else a8(k/2+4,"No drives available",F,0xFFFFFF)end end;aB:d()if aB:l()~="F"then goto aA end;e.shutdown()end;au()a9("Hold CTRL to stay in bootloader",F,.9,29,az)for U=1,#b do av(b[U])end;a9("No drives available",F,0,F,az,F,1)